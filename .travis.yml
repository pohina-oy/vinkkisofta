dist: trusty
sudo: required
language: generic

addons:
  apt:
    packages:
      - docker-ce

script:
  - docker-composer build
  - docker-compose up -d psql
  - sleep 5
  - docker-compose run web npm run db:init
  - docker-compose run web npm run migrate-latest
  - docker-compose run web gradle check

deploy: 
  provider: heroku
  api_key: $HEROKU_API_KEY
  app: vinkkisofta
  on:
    branch: master

after_success:
  - bash <(curl -s https://codecov.io/bash)